if (document.querySelector('.mainslider')) {
	let mainslider = new Swiper('.mainslider__body', {
		/*
		effect: 'fade',
		autoplay: {
			delay: 3000,
			disableOnInteraction: false,
		},
		*/
		observer: true,
		observeParents: true,
		slidesPerView: 1,
		spaceBetween: 0,
		autoHeight: true,
		speed: 800,
		//touchRatio: 0,
		//simulateTouch: false,
		//loop: true,
		//preloadImages: false,
		//lazy: true,
		// Dotts
		pagination: {
			el: '.mainslider__dotts',
			clickable: true,
		},
		// Arrows
		/*navigation: {
			nextEl: '.about__more .more__item_next',
			prevEl: '.about__more .more__item_prev',
		},*/
		/*
		breakpoints: {
			320: {
				slidesPerView: 1,
				spaceBetween: 0,
				autoHeight: true,
			},
			768: {
				slidesPerView: 2,
				spaceBetween: 20,
			},
			992: {
				slidesPerView: 3,
				spaceBetween: 20,
			},
			1268: {
				slidesPerView: 4,
				spaceBetween: 30,
			},
		},
		*/
		on: {
			lazyImageReady: function () {
				ibg();
			},
		}
		// And if we need scrollbar
		//scrollbar: {
		//	el: '.swiper-scrollbar',
		//},
	});

	let mainsliderImages = document.querySelectorAll('.mainslider__image');
	let mainsliderDotts = document.querySelectorAll('.mainslider__dotts .swiper-pagination-bullet');

	for (let index = 0; index < mainsliderImages.length; index++) {
		const mainsliderImage = mainsliderImages[index].querySelector('img').getAttribute('src');
		mainsliderDotts[index].style.backgroundImage = "url(' " + mainsliderImage + " ')";
	}

}

if (document.querySelector('.products-slider')) {
	let productsSlider = new Swiper('.products-slider__item', {
		/*
		effect: 'fade',
		autoplay: {
			delay: 3000,
			disableOnInteraction: false,
		},
		*/
		observer: true,
		observeParents: true,
		slidesPerView: 1,
		spaceBetween: 0,
		autoHeight: true,
		speed: 800,
		//touchRatio: 0,
		//simulateTouch: false,
		//loop: true,
		//preloadImages: false,
		//lazy: true,
		// Dotts
		
		pagination: {
			el: '.products-slider__info',
			type: 'fraction'
		},
		
		// Arrows
		navigation: {
			nextEl: '.products-slider__arrow_next',
			prevEl: '.products-slider__arrow_prev',
		},
		/*
		breakpoints: {
			320: {
				slidesPerView: 1,
				spaceBetween: 0,
				autoHeight: true,
			},
			768: {
				slidesPerView: 2,
				spaceBetween: 20,
			},
			992: {
				slidesPerView: 3,
				spaceBetween: 20,
			},
			1268: {
				slidesPerView: 4,
				spaceBetween: 30,
			},
		},
		*/
		on: {
			lazyImageReady: function () {
				ibg();
			},
		}
		// And if we need scrollbar
		//scrollbar: {
		//	el: '.swiper-scrollbar',
		//},
	});
}

if (document.querySelector('.brands-slider')) {
	let brandsSlider = new Swiper('.brands-slider__body', {
		/*
		effect: 'fade',
		autoplay: {
			delay: 3000,
			disableOnInteraction: false,
		},
		*/
		observer: true,
		observeParents: true,
		slidesPerView: 5,
		spaceBetween: 0,
		//autoHeight: true,
		speed: 800,
		//touchRatio: 0,
		//simulateTouch: false,
		loop: true,
		//preloadImages: false,
		//lazy: true,
		// Dotts

		
		// Arrows
		navigation: {
			nextEl: '.brands-slider__arrow_next',
			prevEl: '.brands-slider__arrow_prev',
		},
		
		breakpoints: {
			320: {
				slidesPerView: 1,
				autoHeight: true,
			},
			480: {
				slidesPerView: 2,
			},			
			600: {
				slidesPerView: 3,
			},
			768: {
				slidesPerView: 4,
			},
			992: {
				slidesPerView: 5,
			},
		},
		on: {
			lazyImageReady: function () {
				ibg();
			},
		}
		// And if we need scrollbar
		//scrollbar: {
		//	el: '.swiper-scrollbar',
		//},
	});
}

if (document.querySelector('.images-product')) {

	let imagesSubSlider = new Swiper('.images-product__subslider', {
		observer: true,
		observeParents: true,
		slidesPerView: 4,
		spaceBetween: 0,
		//autoHeight: true,
		speed: 800,
		//touchRatio: 0,
		//simulateTouch: false,
		//loop: true,
		//preloadImages: false,
		//lazy: true,
	});


	let imagesMainSlider = new Swiper('.images-product__mainslider', {
		observer: true,
		observeParents: true,
		slidesPerView: 1,
		spaceBetween: 0,
		//autoHeight: true,
		speed: 800,
		//touchRatio: 0,
		//simulateTouch: false,
		//loop: true,
		//preloadImages: false,
		//lazy: true,
		thumbs : {
			swiper: imagesSubSlider
		}

	});

}
var isMobile = { Android: function () { return navigator.userAgent.match(/Android/i); }, BlackBerry: function () { return navigator.userAgent.match(/BlackBerry/i); }, iOS: function () { return navigator.userAgent.match(/iPhone|iPad|iPod/i); }, Opera: function () { return navigator.userAgent.match(/Opera Mini/i); }, Windows: function () { return navigator.userAgent.match(/IEMobile/i); }, any: function () { return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows()); } };

function testWebP(callback) {
	var webP = new Image();
	webP.onload = webP.onerror = function () {
		callback(webP.height == 2);
	};
	webP.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
}


testWebP(function (support) {
	if (support === true) {
		document.querySelector('html').classList.add('_webp');
	} else {
		document.querySelector('html').classList.add('_no-webp');
	}
});


//BODY_LOCK
let unlock = true;

function body_lock(delay) {
	let body = $("body");
	if (body.hasClass('_lock')) {
		body_lock_remove(delay);
	} else {
		body_lock_add(delay);
	}
}

function body_lock_remove(delay) {
	let body = $("body");
	if (unlock) {
		let lock_padding = $(".lock-padding");
		setTimeout(() => {
			lock_padding.each(function () { 
				let el = $(this);
				el.css({"padding-right": "0px"});
			});
			body.css({"padding-right": "0px"});
			body.removeClass('_lock');
		}, delay);

		unlock = false;
		setTimeout(function () {
			unlock = true;
		}, delay);
	}
}

function body_lock_add(delay) {
	let body = $("body");
	if (unlock) {
		let lock_padding = $(".lock-padding");
		lock_padding.each(function () { 
			let el = $(this);
			el.css({"padding-right": window.innerWidth - $('.wrapper').outerWidth() + 'px'});
		});
		body.css({"padding-right": window.innerWidth - $('.wrapper').outerWidth() + 'px'});
		body.addClass('_lock');
		unlock = false;
		setTimeout(function () {
			unlock = true;
		}, delay);
	}
}



//MENU
let iconMenu = $(".icon-menu");
if (iconMenu != null) {
	let delay = 500;
	let menuBody = $(".menu__body");
	iconMenu.on("click", function (e) {
		if (unlock) {
			body_lock(delay);
			iconMenu.toggleClass("_active");
			menuBody.toggleClass("_active");
		}
	});
};

//POPUPS
let popupLinks = $('.popup-link');
if (popupLinks.length > 0) {
popupLinks.each(function () {
	let popupLink = $(this);
	popupLink.on("click", function(e) {
		let popupName = popupLink.attr('href').replace('#', '');
		let curentPopup = $('#'+popupName+'');
		popupOpen(curentPopup);
		e.preventDefault();
	});
});
}

let popupCloseIcons = $('.close-popup');
if (popupCloseIcons.length > 0) {
	popupCloseIcons.each(function () {
		let popupCloseIcon = $(this);
		popupCloseIcon.on("click", function(e) {
			popupClose(popupCloseIcon.closest('.popup'));
			e.preventDefault();
		});
	});
}

function popupOpen(curentPopup) {
	if (curentPopup && unlock) {
		let popupActive = $('.popup._active');
		if (popupActive.length > 0) {
			popupClose(popupActive, false);
		} else {
			body_lock_add(500);
		}
		curentPopup.addClass('_active');
		curentPopup.on("click", function (e) {
			if ($(e.target).closest('.popup__content').length == 0) {
				popupClose($(e.target).closest('.popup'));
			}
		});
	}
}

function popupClose(popupActive, doUnlock = true) {
	if (unlock) {
		popupActive.removeClass('_active');
		if (doUnlock) {
			body_lock_remove(500);
		}
	}
}
//MENU ASIDE BURGER 
let menuPageBurger = $('.menu-page__burger');
let menuPageBody = $('.menu-page__body');
menuPageBurger.on("click", function (e) {
    menuPageBurger.toggleClass('_active');
    menuPageBody.slideToggle();
});


//MENU ASIDE
if (isMobile.any()) {
	let menuParents = $('.menu-page__parent > a');
	menuParents.each(function () {
		let menuParent = $(this);
		menuParent.on("click", function(e) {
			menuParent.parent().toggleClass('_active');
			e.preventDefault();
		});
	});
} else {
	let menuParents = $('.menu-page__parent');
	menuParents.each(function () {
		let menuParent = $(this);
		menuParent.on("mouseenter", function(e) {
			menuParent.addClass('_active');
		});
		menuParent.on("mouseleave", function(e) {
			menuParent.removeClass('_active');
		});
	});
}


//SEARCH
let searchTitle = $('.search-page__title');
let categoriesSearch = $('.categories-search');
searchTitle.on("click", function (e) {
    searchTitle.toggleClass('_active');
    categoriesSearch.slideToggle();
});

let searchSelect = $('.search-page__title');
let checkboxCategories = $('.categories-search__checkbox');

checkboxCategories.each(function () { 
	let checkboxCategory = $(this);
	checkboxCategory.on("change", function () {
		checkboxCategory.toggleClass('_active');
		checkboxActiveCategories = $('.categories-search__checkbox._active');
		if (checkboxActiveCategories.length > 0) {
			searchSelect.addClass('_categories');
			let searchQuantity = $('.search-page__quantity', searchSelect);
			searchQuantity.html(searchQuantity.attr('data-text') + ' ' + checkboxActiveCategories.length);
		}else {
			searchSelect.removeClass('_categories');
		}
	});
});


//RANGE
if (document.querySelector('.price-filter__slider')) {
	const priceFilter = document.querySelector('.price-filter__slider');
	if (priceFilter) {
		noUiSlider.create(priceFilter, {
			start: [0, 200000],
			connect: true,
			tooltips: [wNumb({ decimals: 0 }), wNumb({ decimals: 0 })],
			range: {
				'min': [0],
				'max': [200000]
			}
		});
	}
	const priceStart = document.getElementById('price-start');
	const priceEnd = document.getElementById('price-end');
	priceStart.addEventListener('change', function () {
		priceFilter.noUiSlider.set([priceStart.value, null]);
	}); 
	priceEnd.addEventListener('change', function () {
		priceFilter.noUiSlider.set([null, priceEnd.value]);
	}); 
}


//SPOLLERS
let spollers = $('._spoller');
$(spollers).each(function () {
	let spoller = $(this);
	spoller.on("click", function(e) {
		spoller.toggleClass('_active');
		spoller.next().slideToggle();
	});
});


//FILTER
if (isMobile.any()) { 
let filterTitle= $('.filter__title');
filterTitle.on("click", function (e) {
    filterTitle.toggleClass("_active");
	filterTitle.next().slideToggle();
});
}


//QUANTITY
let quantityButtons = $('.quantity__button');
if (quantityButtons.length > 0) {
	quantityButtons.each(function() {
		let quantityButton = $(this);
		quantityButton.on("click", function (e) {
			let value = parseInt(quantityButton.closest('.quantity').find('input').val());
			if (quantityButton.hasClass('quantity__button_plus')) {
				value++;
			} else {
				value = value - 1;
				if (value < 1) {
					value = 1
				}
			}
			quantityButton.closest('.quantity').find('input').val(value);
		});
	});
}

//TABS
let tabs = $("._tabs");
tabs.each(function() {
	tab = $(this);
	let tabs_items = $("._tabs-item", tab);
	let tabs_blocks = $("._tabs-block", tab);
	tabs_items.each(function (index) { 
		let tabs_item = $(this);
		tabs_item.on("click", function(e) {
			tabs_items.each(function (index) { 
				let tabs_item = $(this);
				tabs_item.removeClass('_active');
				tabs_blocks.eq(index).removeClass('_active');
			});
			tabs_item.addClass('_active');
			tabs_blocks.eq(index).addClass('_active');
			e.preventDefault();
		});
	});
});


//CUSTOM SELECT
let customSelects = $('.custom-select');
customSelects.each(function () { 
	customSelect = $(this);
	customSelect.on('click', function(e) {
		$(e.currentTarget).toggleClass('_active');
		$(e.currentTarget).find('.custom-select__dropdown').slideToggle(100);
		if ($(e.target).hasClass('custom-select__item')) {
			let text = $(e.target).text();
			$(e.currentTarget).find('.custom-select__title').text(text);
		}
	});	
});


//FORM
$('#form').submit(function(event) {
	event.preventDefault();
	let self = $(this);
	let data = $(self).serialize();
	let error = 0;

	$('._req', self).each(function () {
		if ($(this).val() == "") {
			$(this).css({"border": "1px solid red"});
			error++;
		}
		else {
			$(this).css({"border": "1px solid #e5e5e5"});
		}
	});
	if (error == 0) {
		$.ajax({
			url: 'php/send.php',
			type: 'POST',
			data: data,
		})
		.done(function(data) {
			console.log(data);
			$(self).trigger("reset");
			$(self).find('.form__success').html('Заявка отправлена');
		});
	}
}); 



